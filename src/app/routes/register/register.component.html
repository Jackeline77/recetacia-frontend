<div class="flex min-h-screen screen bg-[#041a2e]">
  <div class="hidden md:flex w-full h-screen items-center justify-center p-0 m-0 inset-0">
    <img src="register.jpg" alt="Login Image" class="object-cover w-full h-full rounded-none" />
  </div>
  <div class="w-full flex flex-col px-10 py-12">
    <div class="sm:mx-auto sm:w-full sm:max-w-sm">
      <!-- LOGO -->
      <img src="logo_sin_letra.png" alt="Your Company" class="mx-40 h-40 mx-auto" />

      <h2 class="mt-5 text-center text-5xl font-bold tracking-tight text-primary-600">
        Recetacia
      </h2>

      <button class="mt-3 text-indigo-400 hover:text-amber-600 text-sm text-primary-600" (click)="goBack()">
        ← Volver
      </button>
    </div>
    <div class="bg-stone-50 p-8 mt-10 sm:mx-auto sm:w-full sm:max-w-sm rounded-xl shadow-lg">
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- NOMBRE COMPLETO -->
        <div class="flex flex-col gap-2">
          <p-floatLabel>
            <p-iconField>
              <p-inputIcon class="pi pi-user" />
              <input pInputText id="name" formControlName="name" autocomplete="name"
                class="w-full rounded-xl text-base text-gray-800 border-lime-600 focus:border-lime-600 focus:ring-1 focus:ring-lime-600"
                [class.border-red-500]="isFieldInvalid('name')" />
            </p-iconField>
            <label for="name">Nombre completo</label>
          </p-floatLabel>

          <!-- Mensajes de error -->
          <div *ngIf="isFieldInvalid('name')" class="flex flex-col gap-1">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['name'].errors?.['required']">
              El nombre es requerido
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['name'].errors?.['minlength']">
              El nombre debe tener al menos 2 caracteres
            </p-message>
          </div>
        </div>

        <!-- EMAIL -->
        <div class="flex flex-col gap-2">
          <p-floatLabel>
            <p-iconField>
              <p-inputIcon class="pi pi-envelope" />
              <input id="email" type="email" formControlName="email" autocomplete="email" pInputText
                class="w-full rounded-xl text-base text-gray-800 border-lime-600 focus:border-lime-600 focus:ring-1 focus:ring-lime-600"
                [class.border-red-500]="isFieldInvalid('email')" />
            </p-iconField>
            <label for="email">Email</label>
          </p-floatLabel>

          <div *ngIf="isFieldInvalid('email')" class="flex flex-col gap-1">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['email'].errors?.['required']">
              El email es requerido
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['email'].errors?.['email']">
              Formato de email inválido
            </p-message>
          </div>
        </div>

        <!-- PASSWORD -->
        <div class="flex flex-col gap-2">
          <p-floatLabel>
            <p-iconField>
              <p-inputIcon class="pi pi-lock" />
              <input id="password" type="password" formControlName="password" autocomplete="new-password" pInputText
                class="w-full rounded-xl text-base text-gray-800 border-lime-600 focus:border-lime-600 focus:ring-1 focus:ring-lime-600"
                [class.border-red-500]="isFieldInvalid('password')" />
            </p-iconField>
            <label for="password">Contraseña</label>
          </p-floatLabel>

          <div *ngIf="isFieldInvalid('password')" class="flex flex-col gap-1">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['password'].errors?.['required']">
              La contraseña es requerida
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['password'].errors?.['minlength']">
              Mínimo 6 caracteres
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['password'].errors?.['pattern']">
              Debe contener mayúsculas, minúsculas y números
            </p-message>
          </div>
        </div>

        <!-- CONFIRMAR PASSWORD -->
        <div class="flex flex-col gap-2">
          <p-floatLabel>
            <p-iconField>
              <p-inputIcon class="pi pi-lock" />
              <input id="confirmPassword" type="password" formControlName="confirmPassword" autocomplete="new-password"
                pInputText
                class="w-full rounded-xl text-base text-gray-800 border-lime-600 focus:border-lime-600 focus:ring-1 focus:ring-lime-600"
                [class.border-red-500]="isFieldInvalid('confirmPassword')" />
            </p-iconField>
            <label for="confirmPassword">Confirmar Contraseña</label>
          </p-floatLabel>

          <div *ngIf="isFieldInvalid('confirmPassword')" class="flex flex-col gap-1">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['confirmPassword'].errors?.['required']">
              Confirma tu contraseña
            </p-message>
            <p-message severity="error" variant="simple" size="small"
              *ngIf="f['confirmPassword'].errors?.['passwordMismatch']">
              Las contraseñas no coinciden
            </p-message>
          </div>
        </div>

        <!-- TÉRMINOS Y CONDICIONES CON MODAL TIPO GALLERIA -->
        <div class="pt-2 ">
          <!-- Checkbox para aceptar términos -->
          <div class="flex items-center space-x-2 mb-3">
            <p-checkbox [binary]="true" inputId="acceptTerms" formControlName="acceptTerms" class="text-lime-600">
            </p-checkbox>
            <label for="acceptTerms" class="text-sm text-gray-600 cursor-pointer">
              Acepto los
              <span class="text-lime-600 underline hover:text-amber-600 transition-colors" (click)="showTermsModal()">
                términos y condiciones
              </span>
            </label>
          </div>

          <!-- Modal/Dialog para Términos y Condiciones -->
          <p-dialog header="Términos y Condiciones" [(visible)]="displayTermsModal"
            [style]="{ width: '90vw', maxWidth: '800px' }" [modal]="true" [dismissableMask]="true"
            [closeOnEscape]="true" styleClass="terms-dialog">
            <div class="terms-gallery-container ">
              <!-- Contenido de Términos con Scroll -->
              <div class="p-6 ">
                <div class="text-center mb-6">
                  <h3 class="text-2xl font-bold text-lime-700 mb-2">
                    {{ termsContent[currentTermIndex].title }}
                  </h3>
                  <div class="w-20 h-1 bg-lime-500 mx-auto"></div>
                </div>

                <div class="prose max-w-none">
                  <div *ngFor="
                      let paragraph of termsContent[currentTermIndex].content
                    " class="mb-4">
                    <p class="text-gray-700 leading-relaxed text-justify" [innerHTML]="paragraph"></p>
                  </div>
                </div>
              </div>
            </div>

            <ng-template pTemplate="footer">
              <div class="flex justify-between items-center w-full">
                <p-button label="Anterior" icon="pi pi-chevron-left" [text]="true" (click)="previousTerm()"
                  [disabled]="currentTermIndex === 0">
                </p-button>

                <div class="flex space-x-2">
                  <p-button label="Cerrar" [text]="true" (click)="displayTermsModal = false">
                  </p-button>
                  <p-button label="Aceptar" styleClass="bg-lime-600 border-lime-600" (click)="acceptTermsAndClose()">
                  </p-button>
                </div>

                <p-button label="Siguiente" icon="pi pi-chevron-right" iconPos="right" [text]="true"
                  (click)="nextTerm()" [disabled]="currentTermIndex === termsContent.length - 1">
                </p-button>
              </div>
            </ng-template>
          </p-dialog>

          <!-- Mensaje de error para términos -->
          <div *ngIf="isFieldInvalid('acceptTerms')" class="flex flex-col gap-1">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['acceptTerms'].errors?.['required']">
              Debes aceptar los términos y condiciones para continuar
            </p-message>
          </div>
        </div>

        <!-- MENSAJE DE ERROR GENERAL -->
        <div class="bg-red-500/20 text-red-600 px-4 py-2 rounded-md text-sm" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>

        <!-- BOTONES -->
        <div class="flex space-x-3 pt-2">
          <button type="submit"
            class="flex-1 justify-center rounded-xl bg-lime-600 px-3 py-2 text-sm font-semibold text-white hover:bg-amber-600 active:bg-lime-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-lime-700 transition"
            [disabled]="isLoading">
            <span *ngIf="!isLoading">Crear Cuenta</span>
            <span *ngIf="isLoading">Registrando...</span>
          </button>

          <button type="button"
            class="flex-1 justify-center rounded-xl bg-gray-500 px-3 py-2 text-sm font-semibold text-white hover:bg-gray-600 active:bg-gray-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-700 transition"
            (click)="onReset()" [disabled]="isLoading">
            Limpiar
          </button>
        </div>
      </form>

      <p class="mt-6 text-center text-sm text-gray-500">
        ¿Ya tienes cuenta?
        <a (click)="goToLogin()" class="font-semibold text-indigo-400 hover:text-indigo-300">
          Inicia Sesión
        </a>
      </p>
    </div>
  </div>
</div>