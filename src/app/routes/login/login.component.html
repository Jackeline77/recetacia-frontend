<div class="flex min-h-screen bg-[#eeeec3]">
  <div class="w-full md:w-1/2 flex flex-col px-10 py-12">
    <div class="sm:mx-auto sm:w-full sm:max-w-sm">
      <!-- LOGO -->
      <img
        src="logo_sin_letra.png"
        alt="Your Company"
        class="mx-40 h-40 mx-auto"
      />

      <h2
        class="mt-5 text-center text-5xl font-bold tracking-tight text-lime-600"
      >
        Recetacia
      </h2>

      <button
        class="mt-3 text-indigo-400 hover:text-amber-600 text-sm text-primary-600"
        (click)="goBack()"
      >
        ← Volver
      </button>
    </div>

    <div
      class="bg-stone-50 p-8 mt-10 sm:mx-auto sm:w-full sm:max-w-sm rounded-xl shadow-lg"
    >
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- EMAIL -->
        <div>
          <label class="block text-sm font-medium text-primary-600"
            >Email</label
          >
          <div class="mt-2">
            <input
              id="email"
              type="email"
              formControlName="email"
              autocomplete="email"
              (input)="onFieldChange('email')"
              class="block w-full rounded-xl px-3 py-2 text-base text-gray-800 outline-none border border-lime-600 placeholder:text-gray-500 focus:border-lime-600 focus:ring-1 focus:ring-lime-600 transition"
              [class.border-red-500]="isFieldInvalid('email')"
            />
          </div>

          <!-- Mensajes de error para email -->
          <div *ngIf="isFieldInvalid('email')" class="flex flex-col gap-1 mt-2">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['email'].errors?.['required']">
              El email es requerido
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['email'].errors?.['email']">
              Formato de email inválido
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="backendErrors['email']">
              {{ backendErrors['email'] }}
            </p-message>
          </div>
        </div>

        <!-- PASSWORD -->
        <div>
          <label class="block text-sm font-medium text-primary-600">
            Contraseña
            <span class="text-xs text-gray-500 ml-1">
              (mínimo 8 caracteres, incluir mayúscula, minúscula, número y carácter especial)
            </span>
          </label>
          <div class="mt-2">
            <input
              id="password"
              type="password"
              formControlName="password"
              autocomplete="current-password"
              (input)="onFieldChange('password')"
              class="block w-full rounded-xl px-3 py-2 text-base text-gray-800 outline-none border border-lime-600 placeholder:text-gray-500 focus:border-lime-600 focus:ring-1 focus:ring-lime-600 transition"
              [class.border-red-500]="isFieldInvalid('password')"
            />
          </div>

          <!-- Mensajes de error para password -->
          <div *ngIf="isFieldInvalid('password')" class="flex flex-col gap-1 mt-2">
            <p-message severity="error" variant="simple" size="small" *ngIf="f['password'].errors?.['required']">
              La contraseña es requerida
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['password'].errors?.['minlength']">
              La contraseña debe tener al menos 8 caracteres
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="f['password'].errors?.['pattern']">
              La contraseña debe incluir mayúscula, minúscula, número y carácter especial (#$!%*?&)
            </p-message>
            <p-message severity="error" variant="simple" size="small" *ngIf="backendErrors['password']">
              {{ backendErrors['password'] }}
            </p-message>
          </div>
        </div>

        <!-- ✅ MENSAJE ESPECIAL PARA CUENTA NO ENCONTRADA -->
        <div *ngIf="accountNotFound" class="flex flex-col gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <p-message severity="info" variant="simple" size="small">
            ¿No tienes una cuenta? Regístrate para comenzar a usar Recetacia
          </p-message>
          <button
            type="button"
            (click)="goToRegisterFromError()"
            class="w-full justify-center rounded-xl bg-blue-600 px-3 py-2 text-sm font-semibold text-white hover:bg-blue-700 transition-colors"
          >
            Crear Cuenta
          </button>
        </div>

        <!-- ✅ MENSAJE DE ERROR GENERAL -->
        <div *ngIf="errorMessage && !accountNotFound" class="flex flex-col gap-1">
          <p-message severity="error" variant="simple" size="small">
            {{ errorMessage }}
          </p-message>
        </div>

        <button
          type="submit"
          class="flex w-full justify-center rounded-xl bg-lime-600 px-3 py-2 text-sm font-semibold text-white hover:bg-amber-600 active:bg-lime-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-lime-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors mt-6"
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">Iniciar sesión</span>
          <span *ngIf="isLoading">Cargando...</span>
        </button>
      </form>

      <p class="mt-10 text-center text-sm text-gray-500">
        ¿No tienes cuenta?
        <a
          (click)="goToRegister()"
          class="font-semibold text-indigo-400 hover:text-indigo-300 cursor-pointer"
        >
          Regístrate
        </a>
      </p>
    </div>
  </div>

  <!-- COLUMNA DERECHA: IMAGEN -->
  <div
    class="hidden md:flex w-1/2 h-screen items-center justify-center p-0 m-0 inset-0"
  >
    <img
      src="fondo_app.png"
      alt="Login Image"
      class="object-cover w-full h-full rounded-none"
    />
  </div>
</div>